<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Apex Auto Pros - Add Tip</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            -webkit-tap-highlight-color: transparent;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
            box-sizing: border-box;
        }
        h1, h2 {
            margin: 0 0 20px 0;
            color: #1c1c1e;
        }
        .total-display {
            font-size: 2.5em;
            font-weight: bold;
            color: #000;
            margin-bottom: 25px;
        }
        .button-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }
        .button {
            background-color: #007aff;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 20px 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .button:active {
            background-color: #0056b3;
        }
        .button.full-width {
            grid-column: 1 / -1;
        }
        .percentage {
            font-size: 1.4em;
            margin-bottom: 5px;
        }
        .amount {
            font-size: 0.9em;
            opacity: 0.8;
        }
        .screen {
            display: none;
        }
        .screen.active {
            display: block;
        }
        input[type="number"] {
            font-size: 2em;
            width: 100%;
            padding: 10px;
            box-sizing: border-box;
            text-align: center;
            border: 2px solid #ccc;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        #qr-code-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        .qr-code-box {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .qr-code-box canvas, .qr-code-box img {
            border: 1px solid #eee;
        }
        .qr-code-box p {
            margin-top: 10px;
            font-weight: 600;
            color: #333;
        }
        #final-total-display {
            font-size: 2em;
            font-weight: bold;
        }
        #back-button {
            margin-top: 20px;
            background-color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="input-screen" class="screen active">
            <h1>Enter Invoice Total</h1>
            <input type="number" id="invoice-total-input" placeholder="e.g., 542.50" step="0.01" inputmode="decimal">
            <button id="set-total-btn" class="button">Set Total & Show Customer</button>
        </div>
        <div id="tip-screen" class="screen">
            <div id="total-display" class="total-display">$0.00</div>
            <h2>Add a tip?</h2>
            <div id="tip-button-container" class="button-grid">
                <button class="button" data-tip="0.15"><div class="percentage">15%</div><div class="amount" id="tip-15-amount">$0.00</div></button>
                <button class="button" data-tip="0.20"><div class="percentage">20%</div><div class="amount" id="tip-20-amount">$0.00</div></button>
                <button class="button" data-tip="0.25"><div class="percentage">25%</div><div class="amount" id="tip-25-amount">$0.00</div></button>
                <button class="button full-width" data-tip="custom">Custom</button>
                <button class="button full-width" style="background-color:#555;" data-tip="0">No tip</button>
            </div>
        </div>
        <div id="qr-screen" class="screen">
            <h2>Scan to Pay</h2>
            <div id="final-total-display">$0.00</div>
            <div id="qr-code-container"></div>
            <button id="back-button" class="button full-width">Start New Payment</button>
        </div>
    </div>

    <!-- SCRIPT 1: EMBEDDED QR CODE LIBRARY -->
    <script type="text/javascript">var QRCode=function(){function t(t){this.mode=e.MODE_8BIT_BYTE,this.data=t}function e(t,e){this.typeNumber=t,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function r(t,e){if(void 0==t.length)throw new Error(t.length+"/"+e);for(var r=0;r<t.length&&0==t[r];)r++;this.num=new Array(t.length-r+e);for(var i=0;i<t.length-r;i++)this.num[i]=t[i+r]}function i(t,e){this.totalCount=t,this.dataCount=e}function n(){this.buffer=[],this.length=0}t.prototype={getLength:function(t){return this.data.length},write:function(t){for(var e=0;e<this.data.length;e++)t.put(this.data.charCodeAt(e),8)}},e.prototype={addData:function(e){this.dataList.push(new t(e)),this.dataCache=null},isDark:function(t,e){if(t<0||this.moduleCount<=t||e<0||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(t,r){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++){this.modules[i]=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++)this.modules[i][n]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,r),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,r)},setupPositionProbePattern:function(t,e){for(var r=-1;r<=7;r++)if(!(t+r<=-1||this.moduleCount<=t+r))for(var i=-1;i<=7;i++)e+i<=-1||this.moduleCount<=e+i||(r>=0&&r<=6&&(0==i||6==i)||i>=0&&i<=6&&(0==r||6==r)||r>=2&&r<=4&&i>=2&&i<=4?this.modules[t+r][e+i]=!0:this.modules[t+r][e+i]=!1)},getBestMaskPattern:function(){for(var t=0,e=0,r=0;r<8;r++){this.makeImpl(!0,r);var i=o.getLostPoint(this);(0==r||t>i)&&(t=i,e=r)}return e},setupTimingPattern:function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)},setupPositionAdjustPattern:function(){for(var t=o.getPatternPosition(this.typeNumber),e=0;e<t.length;e++)for(var r=0;r<t.length;r++){var i=t[e],n=t[r];if(null==this.modules[i][n])for(var s=-2;s<=2;s++)for(var a=-2;a<=2;a++)-2==s||2==s||-2==a||2==a||0==s&&0==a?this.modules[i+s][n+a]=!0:this.modules[i+s][n+a]=!1}},setupTypeNumber:function(t){for(var e=o.getBCHTypeNumber(this.typeNumber),r=0;r<18;r++){var i=!t&&1==(e>>r&1);this.modules[Math.floor(r/3)][r%3+this.moduleCount-8-3]=i}for(var r=0;r<18;r++){var i=!t&&1==(e>>r&1);this.modules[r%3+this.moduleCount-8-3][Math.floor(r/3)]=i}},setupTypeInfo:function(t,e){for(var r=this.errorCorrectLevel<<3|e,i=o.getBCHTypeInfo(r),n=0;n<15;n++){var s=!t&&1==(i>>n&1);n<6?this.modules[n][8]=s:n<8?this.modules[n+1][8]=s:this.modules[this.moduleCount-15+n][8]=s}for(var n=0;n<15;n++){var s=!t&&1==(i>>n&1);n<8?this.modules[8][this.moduleCount-n-1]=s:n<9?this.modules[8][15-n-1+1]=s:this.modules[8][15-n-1]=s}this.modules[this.moduleCount-8][8]=!t},mapData:function(t,e){for(var r=-1,i=this.moduleCount-1,n=7,s=0,a=this.moduleCount-1;a>0;a-=2)for(6==a&&a--;;){for(var h=0;h<2;h++)if(null==this.modules[i][a-h]){var l=!1;s<t.length&&(l=1==(t[s]>>>n&1)),o.getMask(e,i,a-h)&&(l=!l),this.modules[i][a-h]=l,n--,-1==n&&(s++,n=7)}if((i+=r)<0||this.moduleCount<=i){i-=r,r=-r;break}}}},e.createData=function(t,e,r){for(var n=i.getRSBlocks(t,e),s=new n,a=0;a<r.length;a++){var h=r[a];s.put(h.mode,4),s.put(h.getLength(),o.getLengthInBits(h.mode,t)),h.write(s)}for(var l=0,u=0;u<n.length;u++)l+=n[u].dataCount;if(s.getLengthInBits()>8*l)throw new Error("code length overflow. ("+s.getLengthInBits()+">"+8*l+")");for(s.getLengthInBits()+4<=8*l&&s.put(0,4);s.getLengthInBits()%8!=0;)s.putBit(!1);for(;!(s.getLengthInBits()>=8*l);){if(s.put(236,8),s.getLengthInBits()>=8*l)break;s.put(17,8)}return e.createBytes(s,n)},e.createBytes=function(t,e){for(var i=0,n=0,s=0,a=0;a<e.length;a++){var h=e[a].dataCount,l=e[a].totalCount-h;n=Math.max(n,h),s=Math.max(s,l)}for(var u=new Array(e.length),c=new Array(e.length),f=0,a=0;a<e.length;a++){var d=e[a].dataCount,g=e[a].totalCount-d;u[a]=new Array(d),c[a]=new Array(g);for(var m=0;m<u[a].length;m++)u[a][m]=255&t.buffer[m+f];f+=d;var p=o.getErrorCorrectPolynomial(g),v=new r(u[a],p.getLength()-1),y=v.mod(p);for(m=0;m<c[a].length;m++)c[a][m]=y.num[y.num.length-1-m]}for(var w=new Array(f),B=0,m=0;m<n;m++)for(a=0;a<e.length;a++)m<u[a].length&&(w[B++]=u[a][m]);for(m=0;m<s;m++)for(a=0;a<e.length;a++)m<c[a].length&&(w[B++]=c[a][m]);return w}},e.MODE_NUMBER=1,e.MODE_ALPHA_NUM=2,e.MODE_8BIT_BYTE=4,e.MODE_KANJI=8;var o={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,34,64,94],[6,34,66,98],[6,30,58,86,114],[6,30,58,88,118],[6,34,62,90,122],[6,30,54,78,102,126],[6,26,50,74,98,122,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(t){for(var e=t<<10;o.getBCHDigit(e)-o.getBCHDigit(o.G15)>=0;)e^=o.G15<<o.getBCHDigit(e)-o.getBCHDigit(o.G15);return(t<<10|e)^o.G15_MASK},getBCHTypeNumber:function(t){for(var e=t<<12;o.getBCHDigit(e)-o.getBCHDigit(o.G18)>=0;)e^=o.G18<<o.getBCHDigit(e)-o.getBCHDigit(o.G18);return t<<12|e},getBCHDigit:function(t){for(var e=0;0!=t;)e++,t>>=1;return e},getPatternPosition:function(t){return o.PATTERN_POSITION_TABLE[t-1]},getMask:function(t,e,r){switch(t){case 0:return(e+r)%2==0;case 1:return e%2==0;case 2:return r%3==0;case 3:return(e+r)%3==0;case 4:return(Math.floor(e/2)+Math.floor(r/3))%2==0;case 5:return e*r%2+e*r%3==0;case 6:return(e*r%2+e*r%3)%2==0;case 7:return(e*r%3+(e+r)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}},getLostPoint:function(t){for(var e=t.getModuleCount(),r=0,i=0;i<e;i++)for(var n=0;n<e;n++){for(var s=0,a=t.isDark(i,n),h=-1;h<=1;h++)if(!(i+h<0||e<=i+h))for(var l=-1;l<=1;l++)n+l<0||e<=n+l||0==h&&0==l||a==t.isDark(i+h,n+l)&&s++;s>5&&(r+=3+s-5)}for(var i=0;i<e-1;i++)for(var n=0;n<e-1;n++){var u=0;t.isDark(i,n)&&u++,t.isDark(i+1,n)&&u++,t.isDark(i,n+1)&&u++,t.isDark(i+1,n+1)&&u++,(0==u||4==u)&&(r+=3)}for(var i=0;i<e;i++)for(var n=0;n<e-6;n++)t.isDark(i,n)&&!t.isDark(i,n+1)&&t.isDark(i,n+2)&&t.isDark(i,n+3)&&t.isDark(i,n+4)&&!t.isDark(i,n+5)&&t.isDark(i,n+6)&&(r+=40);for(var n=0;n<e;n++)for(var i=0;i<e-6;i++)t.isDark(i,n)&&!t.isDark(i+1,n)&&t.isDark(i+2,n)&&t.isDark(i+3,n)&&t.isDark(i+4,n)&&!t.isDark(i+5,n)&&t.isDark(i+6,n)&&(r+=40);for(var c=0,n=0;n<e;n++)for(var i=0;i<e;i++)t.isDark(i,n)&&c++;var f=Math.abs(100*c/e/e-50)/5;return r+=10*f},gexp:function(t){return o.EXP_TABLE[t]},glog:function(t){if(t<1)throw new Error("glog("+t+")");return o.LOG_TABLE[t]},getErrorCorrectPolynomial:function(t){for(var e=new r([1],0),i=0;i<t;i++)e=e.multiply(new r([1,o.gexp(i)],0));return e},getLengthInBits:function(t,r){if(r>=1&&r<10)switch(t){case e.MODE_NUMBER:return 10;case e.MODE_ALPHA_NUM:return 9;case e.MODE_8BIT_BYTE:return 8;case e.MODE_KANJI:return 8;default:throw new Error("mode:"+t)}else if(r<27)switch(t){case e.MODE_NUMBER:return 12;case e.MODE_ALPHA_NUM:return 11;case e.MODE_8BIT_BYTE:return 16;case e.MODE_KANJI:return 10;default:throw new Error("mode:"+t)}else{if(!(r<41))throw new Error("type:"+r);switch(t){case e.MODE_NUMBER:return 14;case e.MODE_ALPHA_NUM:return 13;case e.MODE_8BIT_BYTE:return 16;case e.MODE_KANJI:return 12;default:throw new Error("mode:"+t)}}},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)};for(var s=0;s<8;s++)o.EXP_TABLE[s]=1<<s;for(var s=8;s<256;s++)o.EXP_TABLE[s]=o.EXP_TABLE[s-4]^o.EXP_TABLE[s-5]^o.EXP_TABLE[s-6]^o.EXP_TABLE[s-8];for(var s=0;s<255;s++)o.LOG_TABLE[o.EXP_TABLE[s]]=s;r.prototype={get:function(t){return this.num[t]},getLength:function(){return this.num.length},multiply:function(t){for(var e=new Array(this.getLength()+t.getLength()-1),r=0;r<this.getLength();r++)for(var i=0;i<t.getLength();i++)e[r+i]^=o.gexp(o.glog(this.get(r))+o.glog(t.get(i)));return new r(e,0)},mod:function(t){if(this.getLength()-t.getLength()<0)return this;for(var e=o.glog(this.get(0))-o.glog(t.get(0)),i=new Array(this.getLength()),n=0;n<this.getLength();n++)i[n]=this.get(n);for(n=0;n<t.getLength();n++)i[n]^=o.gexp(o.glog(t.get(n))+e);return new r(i,0).mod(t)}},i.getRSBlocks=function(t,e){var r=i.getRsBlockTable(t,e);if(void 0==r)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+e);for(var n=r.length/3,o=[],s=0;s<n;s++)for(var a=r[3*s],h=r[3*s+1],l=r[3*s+2],u=0;u<a;u++)o.push(new this(h,l));return o},i.getRsBlockTable=function(t,r){switch(r){case e.ErrorCorrectLevel.L:return e.RS_BLOCK_TABLE[4*(t-1)];case e.ErrorCorrectLevel.M:return e.RS_BLOCK_TABLE[4*(t-1)+1];case e.ErrorCorrectLevel.Q:return e.RS_BLOCK_TABLE[4*(t-1)+2];case e.ErrorCorrectLevel.H:return e.RS_BLOCK_TABLE[4*(t-1)+3]}},n.prototype={get:function(t){var e=Math.floor(t/8);return 1==(this.buffer[e]>>>7-t%8&1)},put:function(t,e){for(var r=0;r<e;r++)this.putBit(1==(t>>>e-1-r&1))},getLengthInBits:function(){return this.length},putBit:function(t){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var a=function(t,r){"string"==typeof t&&(t=document.getElementById(t)),r=r||{},this.htOption=r,this.el=t,this.oQRCode=null,this.oQRCode=new e(this.htOption.typeNumber||-1,this.htOption.correctLevel||e.ErrorCorrectLevel.H),this.htOption.text&&this.makeCode(this.htOption.text)};return a.prototype.makeCode=function(t){this.oQRCode.addData(t),this.oQRCode.make(),this.el.title=t,this.clear(),this.draw()},a.prototype.draw=function(){var t=this.htOption,e=this.el,r=this.oQRCode.getModuleCount(),i=Math.floor(t.width/r),n=Math.floor(t.height/r),o=document.createElement("table");o.style.width=t.width+"px",o.style.height=t.height+"px",o.style.border="0",o.style.borderCollapse="collapse",o.style.backgroundColor=t.background;for(var s=0;s<r;s++){var a=document.createElement("tr");a.style.height=n+"px";for(var h=0;h<r;h++){var l=document.createElement("td");l.style.width=i+"px",l.style.backgroundColor=this.oQRCode.isDark(s,h)?t.color:t.background,a.appendChild(l)}o.appendChild(a)}e.appendChild(o)},a.prototype.clear=function(){this.el.innerHTML=""},e.ErrorCorrectLevel={L:1,M:0,Q:3,H:2},a}();</script>
    
    <!-- SCRIPT 2: APPLICATION LOGIC -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const VENMO_USERNAME = "Ian-Stefanski";
            const ZELLE_QR_IMAGE_FILENAME = "zelle-qr.png";
            let baseTotal = 0;
            
            const elements = {
                inputScreen: document.getElementById('input-screen'),
                tipScreen: document.getElementById('tip-screen'),
                qrScreen: document.getElementById('qr-screen'),
                totalInput: document.getElementById('invoice-total-input'),
                totalDisplay: document.getElementById('total-display'),
                finalTotalDisplay: document.getElementById('final-total-display'),
                qrContainer: document.getElementById('qr-code-container'),
                setTotalBtn: document.getElementById('set-total-btn'),
                tipButtonContainer: document.getElementById('tip-button-container'),
                backButton: document.getElementById('back-button'),
                tipAmount15: document.getElementById('tip-15-amount'),
                tipAmount20: document.getElementById('tip-20-amount'),
                tipAmount25: document.getElementById('tip-25-amount')
            };

            function showScreen(screenToShow) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                screenToShow.classList.add('active');
            }

            function startTipping() {
                const inputVal = parseFloat(elements.totalInput.value);
                if (isNaN(inputVal) || inputVal <= 0) {
                    alert("Please enter a valid total.");
                    return;
                }
                baseTotal = inputVal;
                elements.totalDisplay.innerText = `$${baseTotal.toFixed(2)}`;
                elements.tipAmount15.innerText = `$${(baseTotal * 0.15).toFixed(2)}`;
                elements.tipAmount20.innerText = `$${(baseTotal * 0.20).toFixed(2)}`;
                elements.tipAmount25.innerText = `$${(baseTotal * 0.25).toFixed(2)}`;
                showScreen(elements.tipScreen);
            }

            function selectTip(tipValue) {
                let tipAmount = 0;
                if (tipValue === 'custom') {
                    const customAmountStr = prompt("Enter custom tip amount:", "10.00");
                    if (customAmountStr === null || isNaN(parseFloat(customAmountStr))) return;
                    tipAmount = parseFloat(customAmountStr);
                } else {
                    tipAmount = baseTotal * parseFloat(tipValue);
                }
                generateQrCodes(baseTotal + tipAmount);
                showScreen(elements.qrScreen);
            }
            
            function generateQrCodes(total) {
                elements.qrContainer.innerHTML = ''; 
                elements.finalTotalDisplay.innerText = `Total to Send: $${total.toFixed(2)}`;
                const size = 128;

                // Venmo
                try {
                    const venmoUrl = `https://venmo.com/${VENMO_USERNAME}?txn=pay&amount=${total.toFixed(2)}Â¬e=Apex%20Auto%20Pros`;
                    const venmoBox = document.createElement('div');
                    venmoBox.className = 'qr-code-box';
                    venmoBox.innerHTML = '<p>Venmo</p>';
                    const venmoQrEl = document.createElement('div');
                    venmoBox.appendChild(venmoQrEl);
                    elements.qrContainer.appendChild(venmoBox);
                    
                    new QRCode(venmoQrEl, {
                        text: venmoUrl,
                        width: size,
                        height: size,
                        correctLevel: QRCode.CorrectLevel.M // Using Medium error correction
                    });
                } catch (error) {
                    console.error("QR Code generation failed:", error);
                    alert("Error creating Venmo QR Code. This is a bug.");
                }

                // Zelle
                const zelleBox = document.createElement('div');
                zelleBox.className = 'qr-code-box';
                zelleBox.innerHTML = `<p>Zelle</p><img src="${ZELLE_QR_IMAGE_FILENAME}" width="${size}" height="${size}" alt="Zelle QR Code">`;
                elements.qrContainer.appendChild(zelleBox);
            }

            function resetApp() {
                elements.totalInput.value = '';
                baseTotal = 0;
                showScreen(elements.inputScreen);
            }

            elements.setTotalBtn.addEventListener('click', startTipping);
            elements.backButton.addEventListener('click', resetApp);
            elements.tipButtonContainer.addEventListener('click', function(event) {
                const button = event.target.closest('button');
                if (button && button.dataset.tip) {
                    selectTip(button.dataset.tip);
                }
            });
        });
    </script>
</body>
</html>
